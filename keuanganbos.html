<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pengelola Keuangan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #334155;
        }
        .container {
            max-width: 900px;
        }
        .login-card, .app-card {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease-in-out;
        }
        .btn {
            @apply px-6 py-3 font-semibold rounded-full transition-colors duration-200;
        }
        .btn-primary {
            @apply bg-indigo-600 text-white hover:bg-indigo-700;
        }
        .btn-secondary {
            @apply bg-gray-200 text-gray-700 hover:bg-gray-300;
        }
        input, select {
            @apply w-full p-3 rounded-lg bg-gray-50 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors;
        }
        table {
            @apply min-w-full divide-y divide-gray-200;
        }
        th, td {
            @apply px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider;
        }
        tr:nth-child(even) {
            background-color: #f9fafb;
        }
        .income-row {
            color: #10B981;
        }
        .expense-row {
            color: #EF4444;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .modal {
            @apply fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900 bg-opacity-75 backdrop-blur-sm;
        }
        .modal-content {
            @apply bg-white p-8 rounded-2xl shadow-xl max-w-sm w-full text-center;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Modal untuk pesan -->
    <div id="message-modal" class="modal hidden">
        <div class="modal-content">
            <p id="modal-text" class="text-gray-800 font-medium mb-4"></p>
            <button onclick="closeModal()" class="btn btn-primary">Tutup</button>
        </div>
    </div>

    <!-- Halaman Login -->
    <div id="login-page" class="login-card p-8 w-full max-w-sm text-center fade-in">
        <h1 class="text-4xl font-extrabold text-indigo-600 mb-2">MyFinance</h1>
        <p class="text-gray-500 mb-8">Kelola keuangan Anda dengan mudah.</p>
        <div class="space-y-4">
            <input type="email" id="email-input" placeholder="Masukkan Email" class="focus:border-indigo-500" required>
            <input type="password" id="password-input" placeholder="Masukkan Kata Sandi" class="focus:border-indigo-500" required>
        </div>
        <div class="flex flex-col space-y-4 mt-6">
            <button id="login-btn" class="btn btn-primary">Masuk</button>
            <button id="register-btn" class="btn btn-secondary">Daftar Akun Baru</button>
        </div>
        <p class="text-xs text-gray-400 mt-6">Data disimpan secara lokal di browser Anda.</p>
    </div>

    <!-- Halaman Utama Aplikasi -->
    <div id="app-page" class="app-card p-8 w-full container hidden fade-in">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Ringkasan Keuangan</h1>
            <button id="logout-btn" class="btn btn-secondary text-sm">Keluar</button>
        </div>

        <!-- Kartu Saldo -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
            <div class="bg-indigo-50 p-6 rounded-2xl shadow-md">
                <p class="text-sm text-indigo-700 font-semibold">Total Saldo</p>
                <p id="balance-amount" class="text-3xl font-bold text-indigo-600 mt-2">Rp 0</p>
            </div>
            <div class="bg-green-50 p-6 rounded-2xl shadow-md">
                <p class="text-sm text-green-700 font-semibold">Total Pemasukan</p>
                <p id="income-amount" class="text-3xl font-bold text-green-600 mt-2">Rp 0</p>
            </div>
            <div class="bg-red-50 p-6 rounded-2xl shadow-md">
                <p class="text-sm text-red-700 font-semibold">Total Pengeluaran</p>
                <p id="expense-amount" class="text-3xl font-bold text-red-600 mt-2">Rp 0</p>
            </div>
        </div>

        <!-- Formulir Transaksi -->
        <div class="bg-gray-50 p-6 rounded-xl mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Tambahkan Transaksi Baru</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <input type="text" id="description-input" placeholder="Deskripsi Transaksi" required>
                <input type="number" id="amount-input" placeholder="Jumlah" required>
                <select id="type-select" required>
                    <option value="pemasukan">Pemasukan</option>
                    <option value="pengeluaran">Pengeluaran</option>
                </select>
                <button id="add-transaction-btn" class="btn btn-primary">Tambah</button>
            </div>
        </div>

        <!-- Tabel Transaksi -->
        <div class="overflow-x-auto bg-white rounded-xl shadow-md p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Riwayat Transaksi</h2>
            <div class="flex justify-end mb-4">
                 <select id="filter-select" class="w-auto p-2 rounded-lg bg-gray-50 border border-gray-300">
                     <option value="all">Semua</option>
                     <option value="pemasukan">Pemasukan</option>
                     <option value="pengeluaran">Pengeluaran</option>
                 </select>
            </div>
            <table class="w-full">
                <thead>
                    <tr>
                        <th class="rounded-tl-lg">Tanggal</th>
                        <th>Deskripsi</th>
                        <th>Jumlah</th>
                        <th class="rounded-tr-lg">Tipe</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="transaction-table-body" class="divide-y divide-gray-200">
                    <!-- Data transaksi akan ditambahkan di sini oleh JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const loginPage = document.getElementById('login-page');
        const appPage = document.getElementById('app-page');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const addTransactionBtn = document.getElementById('add-transaction-btn');
        const descriptionInput = document.getElementById('description-input');
        const amountInput = document.getElementById('amount-input');
        const typeSelect = document.getElementById('type-select');
        const balanceAmount = document.getElementById('balance-amount');
        const incomeAmount = document.getElementById('income-amount');
        const expenseAmount = document.getElementById('expense-amount');
        const transactionTableBody = document.getElementById('transaction-table-body');
        const filterSelect = document.getElementById('filter-select');
        const messageModal = document.getElementById('message-modal');
        const modalText = document.getElementById('modal-text');

        let transactions = [];
        let users = JSON.parse(localStorage.getItem('users')) || {};
        let currentUser = null;

        function showModal(message) {
            modalText.textContent = message;
            messageModal.classList.remove('hidden');
        }

        function closeModal() {
            messageModal.classList.add('hidden');
        }

        function saveUsers() {
            localStorage.setItem('users', JSON.stringify(users));
        }

        function saveTransactions() {
            if (currentUser) {
                localStorage.setItem(`transactions_${currentUser.email}`, JSON.stringify(transactions));
            }
        }

        function loadTransactions() {
            if (currentUser) {
                transactions = JSON.parse(localStorage.getItem(`transactions_${currentUser.email}`)) || [];
                renderTransactions();
                updateSummary();
            }
        }

        function login(email, password) {
            if (users[email] && users[email].password === password) {
                currentUser = users[email];
                loginPage.classList.add('hidden');
                appPage.classList.remove('hidden');
                loadTransactions();
                showModal("Selamat datang kembali!");
            } else {
                showModal("Email atau kata sandi salah.");
            }
        }

        function register(email, password) {
            if (users[email]) {
                showModal("Email ini sudah terdaftar.");
            } else {
                users[email] = { password, transactions: [] };
                saveUsers();
                showModal("Akun berhasil dibuat! Silakan masuk.");
            }
        }

        loginBtn.addEventListener('click', () => {
            const email = document.getElementById('email-input').value;
            const password = document.getElementById('password-input').value;
            if (email && password) {
                login(email, password);
            } else {
                showModal("Mohon isi semua kolom.");
            }
        });

        registerBtn.addEventListener('click', () => {
            const email = document.getElementById('email-input').value;
            const password = document.getElementById('password-input').value;
            if (email && password) {
                register(email, password);
            } else {
                showModal("Mohon isi semua kolom.");
            }
        });

        logoutBtn.addEventListener('click', () => {
            currentUser = null;
            loginPage.classList.remove('hidden');
            appPage.classList.add('hidden');
            transactions = [];
            showModal("Anda telah keluar.");
        });

        addTransactionBtn.addEventListener('click', () => {
            const description = descriptionInput.value.trim();
            const amount = parseFloat(amountInput.value);
            const type = typeSelect.value;
            const date = new Date().toLocaleDateString();

            if (description && amount) {
                transactions.unshift({ description, amount, type, date });
                saveTransactions();
                renderTransactions();
                updateSummary();
                descriptionInput.value = '';
                amountInput.value = '';
            } else {
                showModal("Mohon isi deskripsi dan jumlah.");
            }
        });
        
        filterSelect.addEventListener('change', () => {
            renderTransactions();
        });

        function deleteTransaction(index) {
            transactions.splice(index, 1);
            saveTransactions();
            renderTransactions();
            updateSummary();
        }

        function renderTransactions() {
            transactionTableBody.innerHTML = '';
            const filterType = filterSelect.value;
            const filteredTransactions = transactions.filter(t => filterType === 'all' || t.type === filterType);
            
            filteredTransactions.forEach((t, index) => {
                const row = document.createElement('tr');
                const rowClass = t.type === 'pemasukan' ? 'income-row' : 'expense-row';
                row.classList.add(rowClass);
                
                const amountFormatted = t.amount.toLocaleString('id-ID', { style: 'currency', currency: 'IDR' });
                
                row.innerHTML = `
                    <td class="whitespace-nowrap rounded-bl-lg">${t.date}</td>
                    <td class="whitespace-nowrap">${t.description}</td>
                    <td class="whitespace-nowrap">${amountFormatted}</td>
                    <td class="whitespace-nowrap rounded-br-lg">${t.type}</td>
                    <td class="text-right">
                        <button onclick="deleteTransaction(${index})" class="text-red-500 hover:text-red-700 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 10-2 0v6a1 1 0 102 0V8z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </td>
                `;
                transactionTableBody.appendChild(row);
            });
        }

        function updateSummary() {
            const totalIncome = transactions
                .filter(t => t.type === 'pemasukan')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpense = transactions
                .filter(t => t.type === 'pengeluaran')
                .reduce((sum, t) => sum + t.amount, 0);

            const totalBalance = totalIncome - totalExpense;

            balanceAmount.textContent = totalBalance.toLocaleString('id-ID', { style: 'currency', currency: 'IDR' });
            incomeAmount.textContent = totalIncome.toLocaleString('id-ID', { style: 'currency', currency: 'IDR' });
            expenseAmount.textContent = totalExpense.toLocaleString('id-ID', { style: 'currency', currency: 'IDR' });
        }
        
        // Initial check on page load
        if (currentUser) {
            loginPage.classList.add('hidden');
            appPage.classList.remove('hidden');
            loadTransactions();
        }
    </script>

</body>
</html>
